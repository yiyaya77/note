<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>## 1. 深拷贝（循环引用） | note</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/note/assets/css/0.styles.ea0af404.css" as="style"><link rel="preload" href="/note/assets/js/app.efeb18d0.js" as="script"><link rel="preload" href="/note/assets/js/3.ba400efe.js" as="script"><link rel="preload" href="/note/assets/js/14.390a0949.js" as="script"><link rel="prefetch" href="/note/assets/js/1.e4db4ab8.js"><link rel="prefetch" href="/note/assets/js/10.f142e480.js"><link rel="prefetch" href="/note/assets/js/11.67088ac9.js"><link rel="prefetch" href="/note/assets/js/12.f9a939a7.js"><link rel="prefetch" href="/note/assets/js/13.9d7852ec.js"><link rel="prefetch" href="/note/assets/js/15.6fb64c5e.js"><link rel="prefetch" href="/note/assets/js/16.c70f8fcd.js"><link rel="prefetch" href="/note/assets/js/17.6c660310.js"><link rel="prefetch" href="/note/assets/js/18.c17945bd.js"><link rel="prefetch" href="/note/assets/js/19.bc4aa3ee.js"><link rel="prefetch" href="/note/assets/js/4.2aea456c.js"><link rel="prefetch" href="/note/assets/js/5.35aa4061.js"><link rel="prefetch" href="/note/assets/js/6.6727996d.js"><link rel="prefetch" href="/note/assets/js/7.67ce60ee.js"><link rel="prefetch" href="/note/assets/js/8.8fca7012.js"><link rel="prefetch" href="/note/assets/js/9.932633d1.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.ea0af404.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/record.html" class="nav-link">
  RECORD
</a></div><div class="nav-item"><a href="/note/mix.html" class="nav-link">
  MIX
</a></div><div class="nav-item"><a href="/note/js.html" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/note/性能优化.html" class="nav-link">
  性能优化
</a></div><div class="nav-item"><a href="/note/electron.html" class="nav-link">
  electron
</a></div><div class="nav-item"><a href="/note/programming.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  programming
</a></div><div class="nav-item"><a href="/note/react.html" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/note/webpack.html" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/note/css.html" class="nav-link">
  css
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/record.html" class="nav-link">
  RECORD
</a></div><div class="nav-item"><a href="/note/mix.html" class="nav-link">
  MIX
</a></div><div class="nav-item"><a href="/note/js.html" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/note/性能优化.html" class="nav-link">
  性能优化
</a></div><div class="nav-item"><a href="/note/electron.html" class="nav-link">
  electron
</a></div><div class="nav-item"><a href="/note/programming.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  programming
</a></div><div class="nav-item"><a href="/note/react.html" class="nav-link">
  react
</a></div><div class="nav-item"><a href="/note/webpack.html" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/note/css.html" class="nav-link">
  css
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/note/record.html" class="sidebar-link">RECORD</a></li><li><a href="/note/mix.html" class="sidebar-link">MIX</a></li><li><a href="/note/js.html" class="sidebar-link">JS</a></li><li><a href="/note/性能优化.html" class="sidebar-link">性能优化</a></li><li><a href="/note/electron.html" class="sidebar-link">electron</a></li><li><a href="/note/programming.html" aria-current="page" class="active sidebar-link">programming</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/programming.html#_1-深拷贝-循环引用" class="sidebar-link">1. 深拷贝（循环引用）</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#_2-实现一个promiseall-并限制并发数量" class="sidebar-link">2. 实现一个promiseall，并限制并发数量</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#_3-实现promise-retry-成功后resolve结果-失败后重试-尝试超过一定次数才真正的reject" class="sidebar-link">3. 实现Promise.retry,成功后resolve结果，失败后重试，尝试超过一定次数才真正的reject</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#_4-this指向" class="sidebar-link">4. this指向</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#_5-数组扁平化" class="sidebar-link">5. 数组扁平化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/programming.html#tostring" class="sidebar-link">toString</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#reduce" class="sidebar-link">reduce</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#非递归的方式" class="sidebar-link">非递归的方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/programming.html#_6-路径寻找" class="sidebar-link">6. 路径寻找</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#_7-函数柯里化" class="sidebar-link">7. 函数柯里化</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#_8-call、appaly、bind及bind的实现" class="sidebar-link">8. call、appaly、bind及bind的实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/programming.html#call和apply的区别" class="sidebar-link">call和apply的区别</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#call" class="sidebar-link">call()</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#apply-和-call-的用法" class="sidebar-link">apply 和 call 的用法</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#call-和-bind-的区别" class="sidebar-link">call 和 bind 的区别</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#自己实现bind" class="sidebar-link">自己实现bind</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/programming.html#_9-节流防抖" class="sidebar-link">9. 节流防抖</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/programming.html#防抖-debounce" class="sidebar-link">防抖 debounce</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#节流-throttle" class="sidebar-link">节流 throttle</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/programming.html#_10-作用域" class="sidebar-link">10. 作用域</a></li><li class="sidebar-sub-header"><a href="/note/programming.html#_11-对象扁平化" class="sidebar-link">11. 对象扁平化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/programming.html#数组转树形结构" class="sidebar-link">数组转树形结构</a></li></ul></li></ul></li><li><a href="/note/react.html" class="sidebar-link">react</a></li><li><a href="/note/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/note/css.html" class="sidebar-link">css</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id=""><a href="#" class="header-anchor">#</a></h1> <h2 id="_1-深拷贝-循环引用"><a href="#_1-深拷贝-循环引用" class="header-anchor">#</a> 1. 深拷贝（循环引用）</h2> <p><a href="https://juejin.cn/post/6844903998823088141#heading-0" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6844903998823088141#heading-0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//使用Map函数</span>
<span class="token keyword">function</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> newObj <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        newObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> newObj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
obj1<span class="token punctuation">.</span>z <span class="token operator">=</span> obj1<span class="token punctuation">;</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
<span class="token comment">//node 输出{ x: 1, y: 2, d: { a: 3, b: 4 }, z: [Circular] }</span>
<span class="token comment">//控制台输出{x: 1, y: 2, d: {…}, z: {…}}</span>

</code></pre></div><ul><li><p>return map.get(obj); 返回这个和返回res是一样的。因为在map中保存的数据，是key和value一模一样的键值对, 包括拷贝的目标对象。</p></li> <li><p>Map是如何解决循环引用的？</p> <blockquote><p>是通过存储键值对一样的对象。包括你深拷贝最终返回的对象。就是说你Map中有一个键值对就是key是目标对象，value也是目标对象。当有循环引用，递归调用时，就会加一个条件，如果map中有这个对象的话，直接返回这个对象。前提是，每一次递归的时候，我们保存了这个对象为key，value也为这个对象的键值对在Map中。</p></blockquote></li></ul> <h2 id="_2-实现一个promiseall-并限制并发数量"><a href="#_2-实现一个promiseall-并限制并发数量" class="header-anchor">#</a> 2. 实现一个promiseall，并限制并发数量</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span>time</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>time<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>promise的实现</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myPromiseAll</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span> 
        <span class="token keyword">const</span> n <span class="token operator">=</span> arr<span class="token punctuation">.</span>length 
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> p <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> result 
                count<span class="token operator">++</span> 
                <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">===</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">p1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">p2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token number">1500</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">p3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span>

<span class="token function">myPromiseAll</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>实现一个可以限制并发数的Primise.all</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myPromiseAll</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span>limit</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span> 
        <span class="token keyword">const</span> n <span class="token operator">=</span> arr<span class="token punctuation">.</span>length 
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">function</span> <span class="token function">step</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">===</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                <span class="token keyword">return</span> 
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> result 
                    count<span class="token operator">++</span>
                    <span class="token function">step</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span> 
            <span class="token punctuation">}</span>
            index<span class="token operator">++</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> limit<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">step</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">p1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">p2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">p3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">p4</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">p5</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">,</span>p4<span class="token punctuation">,</span>p5<span class="token punctuation">]</span>

<span class="token function">myPromiseAll</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_3-实现promise-retry-成功后resolve结果-失败后重试-尝试超过一定次数才真正的reject"><a href="#_3-实现promise-retry-成功后resolve结果-失败后重试-尝试超过一定次数才真正的reject" class="header-anchor">#</a> 3. 实现<code>Promise.retry</code>,成功后resolve结果，失败后重试，尝试超过一定次数才真正的<code>reject</code></h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">myPromeRetry</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span>times<span class="token operator">=</span><span class="token number">3</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fn <span class="token operator">||</span> <span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> res<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>times<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">try</span><span class="token punctuation">{</span>
        res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>times<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_4-this指向"><a href="#_4-this指向" class="header-anchor">#</a> 4. this指向</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Person<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// question: </span>
Person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Person<span class="token punctuation">.</span>getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">new</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>答案：</p> <p>==========
<a href="https://juejin.cn/post/6994420985021595662" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6994420985021595662<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>2411233
nodejs 第3个报错</p> <p>主要来看后面三个：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Person<span class="token punctuation">.</span>getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 这里将Person上的静态方法getName函数作为构造函数执行，所以得出结果为：2</span>
<span class="token comment">// 注意：这里是先Foo.getName,然后再new</span>

<span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 这里是先计算new Person()，即调用的是Persono.prototype上的getName()，即得出结果为：3</span>


<span class="token keyword">new</span> <span class="token class-name">new</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 以上代码相当于new((new Person()).getName)();答案输出：3</span>
<span class="token comment">// 这题除了明白new的内部原理之外，得注意js运算符的优先级；</span>
<span class="token comment">// 以 new new Foo().getName()为例，小结一下上述new的优先级顺序：</span>

<span class="token comment">// 先new Foo()</span>
<span class="token comment">// 然后new Foo().getName</span>
<span class="token comment">// 最后new new Foo().getName()</span>
</code></pre></div><h2 id="_5-数组扁平化"><a href="#_5-数组扁平化" class="header-anchor">#</a> 5. 数组扁平化</h2> <p>非递归数组拉平
数组拉平，将数组转换为一维数组，顺序不变</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> 
</code></pre></div><h3 id="tostring"><a href="#tostring" class="header-anchor">#</a> toString</h3> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> input<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token operator">+</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// return input.join().split(',').map(item =&gt; +item);</span>
  <span class="token comment">// return input.join(',').split(',').map(item =&gt; +item);</span>
<span class="token punctuation">}</span>
<span class="token function">flatten</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[1, 2, 3, 1, 2, 3, 4, 2, 3, 4]</span>
<span class="token comment">// 先把数组转换成字符串，这个过程会吧[]去掉，然后再调用split()方法转换成数组,最后不能忘了，把每一项转换为数字，即调用map()方法。</span>
</code></pre></div><blockquote><p>但是输入也可能是字符串，该方法不通用</p></blockquote> <h3 id="reduce"><a href="#reduce" class="header-anchor">#</a> reduce</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// convert to one dimension array</span>
<span class="token keyword">const</span> <span class="token function-variable function">flatten</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">flattened<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">?</span> flattened<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>flattened<span class="token punctuation">,</span> item<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
</code></pre></div><h3 id="非递归的方式"><a href="#非递归的方式" class="header-anchor">#</a> 非递归的方式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">flatten</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> stack<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">...</span>arr<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> temp<span class="token operator">=</span>stack<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      stack<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token operator">...</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-路径寻找"><a href="#_6-路径寻找" class="header-anchor">#</a> 6. 路径寻找</h2> <p>输入一个对象和对象上的一个节点或子节点的值（值唯一），输出该值对象在该对象的key的路径</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_1_1</span><span class="token operator">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token literal-property property">a_1_2</span><span class="token operator">:</span> <span class="token string">'efg'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">b_1</span><span class="token operator">:</span> <span class="token string">'xyz'</span><span class="token punctuation">,</span> <span class="token literal-property property">b_2</span><span class="token operator">:</span> <span class="token string">'111'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token string">'000'</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">findPath</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'xyz'</span><span class="token punctuation">)</span> <span class="token comment">// ['b', 'b_1']</span>


<span class="token keyword">function</span> <span class="token function">findPath</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">function</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keys<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dfs</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
        result<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token function">dfs</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-函数柯里化"><a href="#_7-函数柯里化" class="header-anchor">#</a> 7. 函数柯里化</h2> <p><a href="https://juejin.cn/post/6864378349512065038" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6864378349512065038<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>在数学和计算机科学中，柯里化是一种将使用多个参数的一个函数转换成一系列使用一个参数的函数的技术。</p></blockquote> <p>举例来说，一个接收3个参数的普通函数，在进行柯里化后，
柯里化版本的函数接收一个参数并返回接收下一个参数的函数，
该函数返回一个接收第三个参数的函数。
最后一个函数在接收第三个参数后，
将之前接收到的三个参数应用于原普通函数中，并返回最终结果。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 数学和计算科学中的柯里化：</span>

<span class="token comment">//一个接收三个参数的普通函数</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token operator">+</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//用于将普通函数转化为柯里化版本的工具函数</span>
<span class="token keyword">function</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...内部实现省略，返回一个新函数</span>
<span class="token punctuation">}</span>

<span class="token comment">//获取一个柯里化后的函数</span>
<span class="token keyword">let</span> _sum <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//返回一个接收第二个参数的函数</span>
<span class="token keyword">let</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token function">_sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//返回一个接收第三个参数的函数</span>
<span class="token keyword">let</span> <span class="token constant">B</span> <span class="token operator">=</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//接收到最后一个参数，将之前所有的参数应用到原函数中，并运行</span>
<span class="token constant">B</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>    <span class="token comment">// print : 6</span>
</code></pre></div><p><strong>累加器</strong>
完成一个 sum 函数，实现如下功能，注意需要再执行count的时候才真正求和</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">*</span> 编写函数sum
<span class="token operator">*</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
<span class="token operator">*</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 6*</span>
<span class="token operator">*</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 15 */</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">counter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>args1<span class="token punctuation">)</span>
    <span class="token keyword">return</span> counter
  <span class="token punctuation">}</span>
  counter<span class="token punctuation">.</span><span class="token function-variable function">count</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> pre <span class="token operator">+</span> cur
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> counter
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_8-call、appaly、bind及bind的实现"><a href="#_8-call、appaly、bind及bind的实现" class="header-anchor">#</a> 8. call、appaly、bind及bind的实现</h2> <p><a href="https://github.com/lin-xin/blog/issues/7" target="_blank" rel="noopener noreferrer">https://github.com/lin-xin/blog/issues/7<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="call和apply的区别"><a href="#call和apply的区别" class="header-anchor">#</a> call和apply的区别</h3> <p>ECMAScript 规范给所有函数都定义了 call 与 apply 两个方法，它们的应用非常广泛，它们的作用也是一模一样，只是传参的形式有区别而已。</p> <h4 id="apply"><a href="#apply" class="header-anchor">#</a> apply( )</h4> <p>apply 方法传入两个参数：一个是作为函数上下文的对象，另外一个是作为<strong>函数参数所组成的数组</strong>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'yiyaya'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">firstName<span class="token punctuation">,</span> lastName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>firstName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lastName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// A yiyaya B</span>
</code></pre></div><p>可以看到，obj 是作为函数上下文的对象，函数 func 中 this 指向了 obj 这个对象。参数 A 和 B 是放在数组中传入 func 函数，分别对应 func 参数的列表元素。</p> <h3 id="call"><a href="#call" class="header-anchor">#</a> call()</h3> <p>call 方法第一个参数也是作为函数上下文的对象，但是后面传入的是一个<strong>参数列表</strong>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'yiyaya'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">firstName<span class="token punctuation">,</span> lastName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>firstName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lastName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// C yiyaya D</span>
</code></pre></div><p>对比 apply 我们可以看到区别，C 和 D 是作为单独的参数传给 func 函数，而不是放到数组中。对于什么时候该用什么方法，其实不用纠结。如果你的参数本来就存在一个数组中，那自然就用apply，如果参数比较散乱相互之间没什么关联，就用 call。</p> <h3 id="apply-和-call-的用法"><a href="#apply-和-call-的用法" class="header-anchor">#</a> apply 和 call 的用法</h3> <h4 id="_1-改变-this-指向"><a href="#_1-改变-this-指向" class="header-anchor">#</a> 1.改变 this 指向</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'thea'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// thea</span>
</code></pre></div><p>我们知道，call 方法的第一个参数是作为函数上下文的对象，这里把 obj 作为参数传给了 func，此时函数里的 this 便指向了 obj 对象。此处 func 函数里其实相当于</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-借用别的对象的方法"><a href="#_2-借用别的对象的方法" class="header-anchor">#</a> 2.借用别的对象的方法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Person1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'thea'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">Person2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getname</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">Person1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person<span class="token punctuation">.</span><span class="token function">getname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// thea</span>
</code></pre></div><p>从上面我们看到，Person2 实例化出来的对象 person 通过 getname 方法拿到了 Person1 中的name。因为在 Person2 中，Person1.call(this) 的作用就是使用 Person1 对象代替 this 对象，那么Person2 就有了 Person1 中的所有属性和方法了，相当于 Person2 继承了 Person1 的属性和方法。</p> <h4 id="_3-调用函数"><a href="#_3-调用函数" class="header-anchor">#</a> 3.调用函数</h4> <p>apply、call 方法都会使函数立即执行，因此它们也可以用来调用函数.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'thea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// thea</span>
</code></pre></div><h3 id="call-和-bind-的区别"><a href="#call-和-bind-的区别" class="header-anchor">#</a> call 和 bind 的区别</h3> <p>在 EcmaScript5 中扩展了叫 bind 的方法，在低版本的 IE 中不兼容。它和 call 很相似，接受的参数有两部分，第一个参数是是作为函数上下文的对象，第二部分参数是个列表，可以接受多个参数。
它们之间的区别有以下两点。</p> <h4 id="_1-bind-返回值是函数"><a href="#_1-bind-返回值是函数" class="header-anchor">#</a> 1.bind 返回值是函数</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'thea'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> func1 <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// thea</span>
</code></pre></div><p>bind 方法不会立即执行，而是返回一个改变了上下文 this 后的函数。而原函数 func 中的 this 并没有被改变，依旧指向全局对象 window。</p> <h4 id="_2-参数的使用"><a href="#_2-参数的使用" class="header-anchor">#</a> 2.参数的使用</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> func1 <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'thea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">func</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// A B C</span>
<span class="token function">func1</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// thea A B</span>
<span class="token function">func1</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// thea B C</span>
<span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'thea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// thea undefined undefined</span>
</code></pre></div><p>call 是把第二个及以后的参数作为 func 方法的实参传进去，而 func1 方法的实参实则是在 bind 中参数的基础上再往后排。</p> <h3 id="自己实现bind"><a href="#自己实现bind" class="header-anchor">#</a> 自己实现bind</h3> <p>在低版本浏览器没有 bind 方法，我们也可以自己实现一个。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>bind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">bind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 保存原函数</span>
    <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保存需要绑定的this上下文</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 剩余的参数转为数组</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 返回一个新函数</span>
      <span class="token function">self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>[].shift.call(arguments) 的含义</strong></p> <ul><li>arguments 的含义
arguments 是一个对应于传递给函数的参数的类数组对象。
<img src="data:image/png;base64,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" alt="avator">
上面是我在 chrome 浏览器控制台进行的一个小测试，可以看到，arguments 是一个类数组对象，它的值中包含了我们在调用函数时候，朝里面传入的参数。
而我们知道，对于对象的调用，我们一般采用点号—— obj.key 的调用方式或者括号加对象的key的方
式—— <code>obj[key]</code> ，这两种方式是完全等同的。
因此我们在创建函数的时候，其实并不需要朝里面传入变量，直接用 arguments 的方式来获取变量岂不是更好？虽然这种方式接收参数很灵活，但是也存在弊端，函数的参数阅读不方便。</li> <li>[].shift
其实它就等同于 Array.prototype.shift ，不信你打开你的 chrome 浏览器控制台，试着输入
Array.prototype.shift === [].shift ，然后你看看是不是能够得到 true。也就是说，两者其实是同一个函数，只是调用的方式存在差异，一个是通过原型的方式直接在类上调用；一个是通过实例化，继承过来，然后再调用。
了解了上面以后，我们就能理解了 [].shift.call(arguments) 的含义了。arguments 是类数组对象，它没有 shift 等数组独有的方法，怎么办？现在，我想要拿出传入的参数中的第一个参数，怎么操作，就只有用这种方式了</li></ul> <p>我们来试验一下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> arguments<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> temp <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
temp<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught TypeError: temp.slice is not a function</span>
</code></pre></div><p>我们可以看到，如果你想直接对 temp 用 slice() 函数，做不到,因为 arguments 是类数组对象，并非真正的对象，并没有 slice 方法。
但是如果你用下面方法</p> <p><code>[].slice.call(temp); //[&quot;a&quot;, &quot;b&quot;]</code></p> <p>我们可以看到的是，用上面的方式，就神奇般的得到了想要的结果。
我们在类数组对象上面，成功的运用了数组的 slice 方法。也就是说，相当于，先将 temp 转为数组，然后再对其运用了 slice 方法，然后返回了我们想要的结果。
当然，这种写法，在 es6 面前，已经成为了过去式，es6 为数组新增了一个 from 方法，这个函数的使用方式如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[&quot;a&quot;, &quot;b&quot;]</span>
</code></pre></div><p>因此，我们可以总结下，原来 context = [].shift.call(arguments) 这一句就是把参数中的第一个剪切出来，赋给 context，那么也就相当于起到了将 参数中的 this 保存的目的。</p> <p><code>args = [].slice.call(arguments);</code>
这一句，将除了 this 上下文的所有参数，传给了 args ，以备后来使用</p> <ul><li>bind的理解
要读懂返回值，必须得理解，bind 的作用是什么。</li></ul> <p>简单点理解，bind 就是用来绑定上下文的，强制将函数的执行环境绑定到目标作用域中去。与 call 和apply 其实有点类似，但是不同点在于，它不会立即执行，而是返回一个函数。因此我们要想自己实现一个 bind 函数，就必须要返回一个函数，而且这个函数会接收绑定的参数的上下文。</p> <ul><li>返回函数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 返回一个新函数</span>
  <span class="token function">self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这一段其实很好理解，因为bind 绑定了上下文，因此 self.apply 的第一个参数，是之前我们保存的context。接下来，我们将 bind 的其余参数和调用bind后返回的函数在执行的过程中接收的参数进行拼接，作为一个数组传入apply的第二个参数中去。这就完美的实现了 bind 函数的功能。</p> <h2 id="_9-节流防抖"><a href="#_9-节流防抖" class="header-anchor">#</a> 9. 节流防抖</h2> <h3 id="防抖-debounce"><a href="#防抖-debounce" class="header-anchor">#</a> 防抖 debounce</h3> <p>函数防抖就是在函数需要频繁触发的情况下，只有足够的空闲时间，才执行一次。 就是指触发事件后在 n 秒内函数只能执行一次，如果在 n 秒内又触发了事件，则会重新计算函数执行时间。直到<strong>n秒内没有被再次点击，才执行事件</strong>。</p> <p>典型应用</p> <ul><li>百度搜索框在输入稍有停顿时才更新推荐热词。</li> <li>拖拽</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">handler<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  delay <span class="token operator">=</span> delay <span class="token operator">||</span> <span class="token number">300</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> _self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> _args <span class="token operator">=</span> args<span class="token punctuation">;</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_self<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="节流-throttle"><a href="#节流-throttle" class="header-anchor">#</a> 节流 throttle</h3> <p>一个函数只有在大于执行周期时才执行，周期内调用不执行。好像水滴积攒到一定程度才会触发一次下落一样。就是<strong>不论点击多少次，n秒内只执行一次</strong>。</p> <p>典型应用：</p> <ul><li>抢券时疯狂点击，既要限制次数，又要保证先点先发出请求</li> <li>窗口调整</li> <li>页面滚动</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">handler<span class="token punctuation">,</span> wait</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  wait <span class="token operator">=</span> wait <span class="token operator">||</span> <span class="token number">300</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> lastTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> _self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> _args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
    <span class="token keyword">const</span> nowTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>nowTime <span class="token operator">-</span> lastTime<span class="token punctuation">)</span> <span class="token operator">&gt;</span> wait<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">handler</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_self<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      lastTime <span class="token operator">=</span> nowTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fun<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> last<span class="token punctuation">;</span> 
  <span class="token keyword">let</span> deferTimer<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> _args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
    <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>deferTimer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里的计时器应该只是确保最后一次调用的时候也可以触发？</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>last <span class="token operator">&amp;&amp;</span> now <span class="token operator">&lt;</span> last <span class="token operator">+</span> delay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      deferTimer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        last <span class="token operator">=</span> now<span class="token punctuation">;</span>
        <span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      last <span class="token operator">=</span> now<span class="token punctuation">;</span>
      <span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>复杂但好用版：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> interval<span class="token punctuation">,</span> context<span class="token punctuation">,</span> firstTime</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer<span class="token punctuation">;</span>
  firstTime <span class="token operator">=</span> <span class="token keyword">typeof</span> firstTime <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">?</span> firstTime <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
    <span class="token keyword">let</span> __me <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> context <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      __me <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>__me<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>firstTime <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>__me<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>节流与防抖的本质:</p> <ul><li>以闭包的形式存在，通过对事件对应的回调函数进行包裹、以自由变量的形式缓存时间信息，最后用定时器或时间差来控制事件的触发频率</li></ul> <h2 id="_10-作用域"><a href="#_10-作用域" class="header-anchor">#</a> 10. 作用域</h2> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">const</span> func <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> func
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> run <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>答案：2
注释掉 const a = 2后答案为1</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">const</span> func <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>答案：1</p> <h2 id="_11-对象扁平化"><a href="#_11-对象扁平化" class="header-anchor">#</a> 11. 对象扁平化</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 实现一个 flatten 函数，实现如下的转换功能</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">e</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">f</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">g</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 转换为</span>
<span class="token keyword">let</span> objRes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;b[0]&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;b[1]&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;b[2].c&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;c.e&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;c.f&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token literal-property property">g</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function-variable function">flatten</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">innerCopy</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Object</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">!==</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> value<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">innerCopy</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> keysArr <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keysArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">innerCopy</span><span class="token punctuation">(</span>key <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> item<span class="token punctuation">,</span> value<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">innerCopy</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="数组转树形结构"><a href="#数组转树形结构" class="header-anchor">#</a> 数组转树形结构</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'部门1'</span><span class="token punctuation">,</span> <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'部门2'</span><span class="token punctuation">,</span> <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'部门3'</span><span class="token punctuation">,</span> <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'部门4'</span><span class="token punctuation">,</span> <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'部门5'</span><span class="token punctuation">,</span> <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;部门1&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;部门2&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;部门3&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;部门4&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">pid</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;部门5&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">pid</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span>
              <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 递归</span>
<span class="token keyword">function</span> <span class="token function">objToTree</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pid <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token operator">...</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token function">objToTree</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 循环</span>
<span class="token keyword">function</span> <span class="token function">objToTree</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> pid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> resMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      resMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span>item<span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      resMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span>resMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>item <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>resMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      resMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>resMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      resMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>pid<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>resMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> resMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/electron.html" class="prev">
        electron
      </a></span> <span class="next"><a href="/note/react.html">
        react
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.efeb18d0.js" defer></script><script src="/note/assets/js/3.ba400efe.js" defer></script><script src="/note/assets/js/14.390a0949.js" defer></script>
  </body>
</html>
